<html>
    <head>
        <title>My first three.js app</title>
        <style>
            body { margin: 0; }
            canvas { width: 100%; height: 100% }
        </style>
    </head>
    <body>
        <script src="js/three.js"></script>
        <script>
            /* load frames */
            var request = new XMLHttpRequest();
            request.open("GET", "data/game.json", false);
            request.send(null)
            var savedgame = JSON.parse(request.responseText);
            var frames = savedgame['frames'];

            /* setup scene, camera and renderer */
            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );

            var renderer = new THREE.WebGLRenderer();
            renderer.setSize( window.innerWidth, window.innerHeight );
            document.body.appendChild( renderer.domElement );
            renderer.sortObjects = false;

            /* put camera at corner of arena and look at center */
            camera.position.set(60,-35,30);
            camera.up = new THREE.Vector3(0,0,1);
            camera.lookAt(new THREE.Vector3(0,0,0));

            /* add some lighting */
            var ambient = new THREE.AmbientLight(0xA0A0A0);
            scene.add(ambient);

            var light = new THREE.PointLight(0xffffff, 1, 10000);
            light.position.set(0, -35, 30);
            scene.add( light );

            /* add arena meshes */
            var arenaGeo = new THREE.BoxGeometry(80, 30, 20);
            var arenaMat = new THREE.MeshLambertMaterial({color: 0x00ff00, transparent: true, opacity: 0.2});

            var wireframe = new THREE.WireframeGeometry(arenaGeo);
            var line = new THREE.LineSegments(wireframe);
            line.material.opacity = 0.5;
            line.material.transparent = true;
            scene.add(line);

            var arena = new THREE.Mesh(arenaGeo, arenaMat);
            scene.add(arena);

            /* add player meshes */
            orangePlayers = []
            bluePlayers = []
            var playerGeo = new THREE.SphereGeometry( 1, 32, 32 );
            var playerOrangeMat = new THREE.MeshBasicMaterial({color: 0xffa500});
            var playerBlueMat = new THREE.MeshBasicMaterial({color: 0x0000ff});

            orangePlayers.push(new THREE.Mesh(playerGeo, playerOrangeMat));
            orangePlayers.push(new THREE.Mesh(playerGeo, playerOrangeMat));
            orangePlayers.push(new THREE.Mesh(playerGeo, playerOrangeMat));
            bluePlayers.push(new THREE.Mesh(playerGeo, playerBlueMat));
            bluePlayers.push(new THREE.Mesh(playerGeo, playerBlueMat));
            bluePlayers.push(new THREE.Mesh(playerGeo, playerBlueMat));
            for (var i = 0; i < 3; i++) {
                scene.add(orangePlayers[i]);
                scene.add(bluePlayers[i]);
            }

            var setPlayerPosition = function(player, framepos) {
                player.position.x = framepos[2];
                player.position.y = framepos[0];
                player.position.z = framepos[1];
            }

            /* frame index */
            var idx = 0;

            var animate = function () {
                frame = frames[idx];
                idx += 1;
                requestAnimationFrame( animate );

                for (var i = 0; i < 3; i++) {
                    setPlayerPosition(orangePlayers[i], frame.teams[0].players[i].position);
                    setPlayerPosition(bluePlayers[i], frame.teams[1].players[i].position);
                }

                renderer.render( scene, camera );
            };

            animate();
        </script>
    </body>
</html>
